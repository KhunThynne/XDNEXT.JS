// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource postgresql {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                           String             @id @default(uuid()) @postgresql.Uuid
  name                         String             @default("")
  username                     String             @default("")
  provider                     String             @default("credentials")
  image                        String             @default("")
  images                       Image[]            @relation("User_images")
  role                         String?            @default("USER")
  email                        String             @unique @default("")
  createdAt                    DateTime?          @default(now())
  password                     String
  yourItem                     UserItem[]         @relation("UserItem_userId")
  yourPoint                    UserPoint?         @relation("User_yourPoint", fields: [yourPointId], references: [id])
  yourPointId                  String?            @unique @map("yourPoint") @postgresql.Uuid
  yourSuppiler                 Supplier[]         @relation("Supplier_userId")
  order                        Order[]            @relation("Order_userId")
  preference                   UserPreference?    @relation("User_preference", fields: [preferenceId], references: [id])
  preferenceId                 String?            @unique @map("preference") @postgresql.Uuid
  posts                        Post[]             @relation("Post_author")
  passwordResetToken           String?
  passwordResetIssuedAt        DateTime?
  passwordResetRedeemedAt      DateTime?
  from_PointTransaction_userId PointTransaction[] @relation("PointTransaction_userId")
}

model UserItem {
  id          String     @id @default(uuid()) @postgresql.Uuid
  userId      User?      @relation("UserItem_userId", fields: [userIdId], references: [id])
  userIdId    String?    @map("userId") @postgresql.Uuid
  productId   Product?   @relation("UserItem_productId", fields: [productIdId], references: [id])
  productIdId String?    @map("productId") @postgresql.Uuid
  item        OrderItem? @relation("OrderItem_userItem")
  config      Json?      @default("{}")
  createdAt   DateTime?  @default(now())
  updateAt    DateTime?  @default(now())

  @@index([userIdId])
  @@index([productIdId])
}

model UserPreference {
  id      String @id @default(uuid()) @postgresql.Uuid
  userId  User?  @relation("User_preference")
  setting Json   @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
}

model UserPoint {
  id          String    @id @default(uuid()) @postgresql.Uuid
  userId      User?     @relation("User_yourPoint")
  total_point Int       @default(0)
  updateAt    DateTime? @default(now())
}

model Supplier {
  id              String    @id @default(uuid()) @postgresql.Uuid
  userId          User?     @relation("Supplier_userId", fields: [userIdId], references: [id])
  userIdId        String?   @map("userId") @postgresql.Uuid
  products        Product[] @relation("Product_suppilersId")
  supplierName    String    @default("")
  supplierDetails String    @default("")

  @@index([userIdId])
}

model Order {
  id        String      @id @default(uuid()) @postgresql.Uuid
  userId    User?       @relation("Order_userId", fields: [userIdId], references: [id])
  userIdId  String?     @map("userId") @postgresql.Uuid
  items     OrderItem[] @relation("OrderItem_orderId")
  createdAt DateTime?   @default(now())
  updateAt  DateTime?   @default(now())

  @@index([userIdId])
}

model OrderItem {
  id          String    @id @default(uuid()) @postgresql.Uuid
  orderId     Order?    @relation("OrderItem_orderId", fields: [orderIdId], references: [id])
  orderIdId   String?   @map("orderId") @postgresql.Uuid
  productId   Product?  @relation("OrderItem_productId", fields: [productIdId], references: [id])
  productIdId String?   @map("productId") @postgresql.Uuid
  userItem    UserItem? @relation("OrderItem_userItem", fields: [userItemId], references: [id])
  userItemId  String?   @unique @map("userItem") @postgresql.Uuid
  unitPrice   Int?
  updateAt    DateTime?

  @@index([orderIdId])
  @@index([productIdId])
}

model Product {
  id                              String             @id @default(uuid()) @postgresql.Uuid
  suppilersId                     Supplier?          @relation("Product_suppilersId", fields: [suppilersIdId], references: [id])
  suppilersIdId                   String?            @map("suppilersId") @postgresql.Uuid
  name                            String             @default("")
  details                         String             @default("")
  status                          String             @default("draft")
  publishedAt                     DateTime?
  updateAt                        DateTime?          @default(now())
  createdAt                       DateTime?          @default(now())
  images                          Image[]            @relation("Product_images")
  from_UserItem_productId         UserItem[]         @relation("UserItem_productId")
  from_OrderItem_productId        OrderItem[]        @relation("OrderItem_productId")
  from_ProductPromotion_productId ProductPromotion[] @relation("ProductPromotion_productId")

  @@index([suppilersIdId])
}

model ProductPromotion {
  id          String      @id @default(uuid()) @postgresql.Uuid
  productId   Product?    @relation("ProductPromotion_productId", fields: [productIdId], references: [id])
  productIdId String?     @map("productId") @postgresql.Uuid
  promotionId Promotion[] @relation("ProductPromotion_promotionId")
  publishedAt DateTime?
  images      Image[]     @relation("ProductPromotion_images")

  @@index([productIdId])
}

model Promotion {
  id                                String             @id @default(uuid()) @postgresql.Uuid
  name                              String             @default("")
  discountType                      String?            @default("Percent")
  discountValue                     Int?               @default(0)
  publishedAt                       DateTime?          @default(now())
  from_ProductPromotion_promotionId ProductPromotion[] @relation("ProductPromotion_promotionId")
}

model PointTransaction {
  id          String @id @default(uuid()) @postgresql.Uuid
  userId      User[] @relation("PointTransaction_userId")
  type        String @default("Earn")
  amount      Int?
  description Json   @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
}

model Image {
  id                           String             @id @default(uuid()) @postgresql.Uuid
  name                         String             @default("")
  altText                      String             @default("")
  src_id                       String?
  src_filesize                 Int?
  src_width                    Int?
  src_height                   Int?
  src_extension                String?
  from_User_images             User[]             @relation("User_images")
  from_Product_images          Product[]          @relation("Product_images")
  from_ProductPromotion_images ProductPromotion[] @relation("ProductPromotion_images")
}

model Tag {
  id    String @id @default(uuid()) @postgresql.Uuid
  name  String @default("")
  posts Post[] @relation("Post_tags")
}

model Post {
  id       String  @id @default(uuid()) @postgresql.Uuid
  title    String  @default("")
  content  Json    @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  author   User?   @relation("Post_author", fields: [authorId], references: [id])
  authorId String? @map("author") @postgresql.Uuid
  tags     Tag[]   @relation("Post_tags")

  @@index([authorId])
}
