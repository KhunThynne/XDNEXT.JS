// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource postgresql {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                           String             @id @default(uuid()) @postgresql.Uuid
  name                         String             @default("")
  username                     String             @default("")
  provider                     String             @default("credentials")
  image                        String             @default("")
  avartar                      Image?             @relation("User_avartar", fields: [avartarId], references: [id])
  avartarId                    String?            @map("avartar") @postgresql.Uuid
  role                         String?            @default("USER")
  email                        String             @unique @default("")
  createdAt                    DateTime?          @default(now())
  password                     String
  yourItem                     UserItem[]         @relation("UserItem_user")
  yourPoint                    UserPoint?         @relation("User_yourPoint", fields: [yourPointId], references: [id])
  yourPointId                  String?            @unique @map("yourPoint") @postgresql.Uuid
  yourSuppiler                 Supplier[]         @relation("Supplier_user")
  order                        Order[]            @relation("Order_user")
  preference                   UserPreference?    @relation("User_preference", fields: [preferenceId], references: [id])
  preferenceId                 String?            @unique @map("preference") @postgresql.Uuid
  posts                        Post[]             @relation("Post_author")
  passwordResetToken           String?
  passwordResetIssuedAt        DateTime?
  passwordResetRedeemedAt      DateTime?
  from_PointTransaction_userId PointTransaction[] @relation("PointTransaction_userId")

  @@index([avartarId])
}

model UserItem {
  id        String     @id @default(uuid()) @postgresql.Uuid
  user      User?      @relation("UserItem_user", fields: [userId], references: [id])
  userId    String?    @map("user") @postgresql.Uuid
  product   Product?   @relation("UserItem_product", fields: [productId], references: [id])
  productId String?    @map("product") @postgresql.Uuid
  item      OrderItem? @relation("OrderItem_userItem")
  config    Json?      @default("{}")
  createdAt DateTime?  @default(now())
  updateAt  DateTime?  @default(now())

  @@index([userId])
  @@index([productId])
}

model UserPreference {
  id      String @id @default(uuid()) @postgresql.Uuid
  user    User?  @relation("User_preference")
  setting Json   @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
}

model UserPoint {
  id          String    @id @default(uuid()) @postgresql.Uuid
  user        User?     @relation("User_yourPoint")
  total_point Int       @default(0)
  updateAt    DateTime? @default(now())
}

model Supplier {
  id          String    @id @default(uuid()) @postgresql.Uuid
  user        User?     @relation("Supplier_user", fields: [userId], references: [id])
  userId      String?   @map("user") @postgresql.Uuid
  products    Product[] @relation("Product_suppilers")
  name        String    @default("")
  description String    @default("")

  @@index([userId])
}

model Order {
  id        String      @id @default(uuid()) @postgresql.Uuid
  user      User?       @relation("Order_user", fields: [userId], references: [id])
  userId    String?     @map("user") @postgresql.Uuid
  items     OrderItem[] @relation("OrderItem_order")
  createdAt DateTime?   @default(now())
  updateAt  DateTime?   @default(now())

  @@index([userId])
}

model OrderItem {
  id          String    @id @default(uuid()) @postgresql.Uuid
  order       Order?    @relation("OrderItem_order", fields: [orderId], references: [id])
  orderId     String?   @map("order") @postgresql.Uuid
  productId   Product?  @relation("OrderItem_productId", fields: [productIdId], references: [id])
  productIdId String?   @map("productId") @postgresql.Uuid
  userItem    UserItem? @relation("OrderItem_userItem", fields: [userItemId], references: [id])
  userItemId  String?   @unique @map("userItem") @postgresql.Uuid
  unitPrice   Int?
  updateAt    DateTime?

  @@index([orderId])
  @@index([productIdId])
}

model Product {
  id                              String             @id @default(uuid()) @postgresql.Uuid
  status                          String             @default("draft")
  suppilers                       Supplier?          @relation("Product_suppilers", fields: [suppilersId], references: [id])
  suppilersId                     String?            @map("suppilers") @postgresql.Uuid
  tags                            Tag[]              @relation("Product_tags")
  name                            String             @default("")
  description                     String             @default("")
  details                         Json               @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  images                          Image[]            @relation("Product_images")
  publishedAt                     DateTime?
  updateAt                        DateTime?          @default(now())
  createdAt                       DateTime?          @default(now())
  from_UserItem_product           UserItem[]         @relation("UserItem_product")
  from_OrderItem_productId        OrderItem[]        @relation("OrderItem_productId")
  from_ProductPromotion_productId ProductPromotion[] @relation("ProductPromotion_productId")

  @@index([suppilersId])
}

model ProductPromotion {
  id          String      @id @default(uuid()) @postgresql.Uuid
  productId   Product?    @relation("ProductPromotion_productId", fields: [productIdId], references: [id])
  productIdId String?     @map("productId") @postgresql.Uuid
  promotionId Promotion[] @relation("ProductPromotion_promotionId")
  publishedAt DateTime?
  images      Image[]     @relation("ProductPromotion_images")

  @@index([productIdId])
}

model Promotion {
  id                                String             @id @default(uuid()) @postgresql.Uuid
  name                              String             @default("")
  discountType                      String?            @default("Percent")
  discountValue                     Int?               @default(0)
  publishedAt                       DateTime?          @default(now())
  from_ProductPromotion_promotionId ProductPromotion[] @relation("ProductPromotion_promotionId")
}

model PointTransaction {
  id          String @id @default(uuid()) @postgresql.Uuid
  userId      User[] @relation("PointTransaction_userId")
  type        String @default("Earn")
  amount      Int?
  description Json   @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
}

model Image {
  id                           String             @id @default(uuid()) @postgresql.Uuid
  name                         String             @default("")
  altText                      String             @default("")
  src_id                       String?
  src_filesize                 Int?
  src_width                    Int?
  src_height                   Int?
  src_extension                String?
  from_User_avartar            User[]             @relation("User_avartar")
  from_Product_images          Product[]          @relation("Product_images")
  from_ProductPromotion_images ProductPromotion[] @relation("ProductPromotion_images")
}

model Tag {
  id                String    @id @default(uuid()) @postgresql.Uuid
  name              String    @default("")
  posts             Post[]    @relation("Post_tags")
  from_Product_tags Product[] @relation("Product_tags")
}

model Post {
  id       String  @id @default(uuid()) @postgresql.Uuid
  title    String  @default("")
  content  Json    @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  author   User?   @relation("Post_author", fields: [authorId], references: [id])
  authorId String? @map("author") @postgresql.Uuid
  tags     Tag[]   @relation("Post_tags")

  @@index([authorId])
}
