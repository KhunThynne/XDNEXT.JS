// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource postgresql {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model Setting {
  id       Int    @id
  smtpHost String @default("")
  smtpPort String @default("")
  smtpUser String @default("")
  smtpPass String @default("")
  redirect String @default("")
}

model User {
  id                         String             @id @default(uuid()) @postgresql.Uuid
  name                       String             @default("")
  username                   String             @default("")
  provider                   String             @default("credentials")
  image                      String             @default("")
  avartar                    Image?             @relation("User_avartar", fields: [avartarId], references: [id])
  avartarId                  String?            @map("avartar") @postgresql.Uuid
  role                       String?            @default("USER")
  email                      String             @unique @default("")
  password                   String
  createdAt                  DateTime?          @default(now())
  accounts                   Account[]          @relation("Account_user")
  carts                      Cart[]             @relation("Cart_user")
  items                      UserItem[]         @relation("UserItem_user")
  point                      UserPoint?         @relation("User_point", fields: [pointId], references: [id])
  pointId                    String?            @unique @map("point") @postgresql.Uuid
  suppiler                   Supplier[]         @relation("Supplier_user")
  orders                     Order[]            @relation("Order_user")
  preference                 UserPreference?    @relation("User_preference", fields: [preferenceId], references: [id])
  preferenceId               String?            @unique @map("preference") @postgresql.Uuid
  posts                      Post[]             @relation("Post_author")
  passwordResetToken         String?
  passwordResetIssuedAt      DateTime?
  passwordResetRedeemedAt    DateTime?
  from_PointTransaction_user PointTransaction[] @relation("PointTransaction_user")

  @@index([avartarId])
}

model Account {
  id                String    @id @default(uuid()) @postgresql.Uuid
  provider          String    @default("")
  providerAccountId String    @default("")
  user              User?     @relation("Account_user", fields: [userId], references: [id])
  userId            String?   @map("user") @postgresql.Uuid
  accessToken       String    @default("")
  refreshToken      String    @default("")
  expiresAt         DateTime?
  scope             String    @default("")
  meta              Json?

  @@index([userId])
}

model Rating {
  id                   String    @id @default(uuid()) @postgresql.Uuid
  score                Int
  comment              String    @default("")
  createdAt            DateTime? @default(now())
  updateAt             DateTime? @default(now())
  from_Product_ratings Product[] @relation("Product_ratings")
}

model UserItem {
  id        String     @id @default(uuid()) @postgresql.Uuid
  user      User?      @relation("UserItem_user", fields: [userId], references: [id])
  userId    String?    @map("user") @postgresql.Uuid
  item      OrderItem? @relation("OrderItem_userItem")
  config    Json?      @default("{}")
  createdAt DateTime?  @default(now())
  updateAt  DateTime?  @default(now())

  @@index([userId])
}

model UserPreference {
  id      String @id @default(uuid()) @postgresql.Uuid
  user    User?  @relation("User_preference")
  setting Json   @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
}

model UserPoint {
  id          String    @id @default(uuid()) @postgresql.Uuid
  user        User?     @relation("User_point")
  total_point Int       @default(0)
  updateAt    DateTime? @default(now())
}

model Supplier {
  id          String    @id @default(uuid()) @postgresql.Uuid
  user        User?     @relation("Supplier_user", fields: [userId], references: [id])
  userId      String?   @map("user") @postgresql.Uuid
  products    Product[] @relation("Product_suppilers")
  name        String    @default("")
  description String    @default("")

  @@index([userId])
}

model Cart {
  id        String     @id @default(uuid()) @postgresql.Uuid
  user      User?      @relation("Cart_user", fields: [userId], references: [id])
  userId    String?    @map("user") @postgresql.Uuid
  status    String?    @default("ACTIVE")
  items     CartItem[] @relation("CartItem_cart")
  createdAt DateTime?  @default(now())
  updateAt  DateTime?  @default(now())

  @@index([userId])
}

model CartItem {
  id        String    @id @default(uuid()) @postgresql.Uuid
  cart      Cart?     @relation("CartItem_cart", fields: [cartId], references: [id])
  cartId    String?   @map("cart") @postgresql.Uuid
  product   Product?  @relation("CartItem_product", fields: [productId], references: [id])
  productId String?   @map("product") @postgresql.Uuid
  quantity  Int       @default(1)
  createdAt DateTime? @default(now())
  updateAt  DateTime? @default(now())

  @@index([cartId])
  @@index([productId])
}

model Order {
  id                           String             @id @default(uuid()) @postgresql.Uuid
  user                         User?              @relation("Order_user", fields: [userId], references: [id])
  userId                       String?            @map("user") @postgresql.Uuid
  items                        OrderItem[]        @relation("OrderItem_order")
  status                       String             @default("PENDING")
  createdAt                    DateTime?          @default(now())
  updateAt                     DateTime?          @default(now())
  from_PointTransaction_orders PointTransaction[] @relation("PointTransaction_orders")

  @@index([userId])
}

model OrderItem {
  id         String    @id @default(uuid()) @postgresql.Uuid
  order      Order?    @relation("OrderItem_order", fields: [orderId], references: [id])
  orderId    String?   @map("order") @postgresql.Uuid
  product    Product?  @relation("OrderItem_product", fields: [productId], references: [id])
  productId  String?   @map("product") @postgresql.Uuid
  userItem   UserItem? @relation("OrderItem_userItem", fields: [userItemId], references: [id])
  userItemId String?   @unique @map("userItem") @postgresql.Uuid
  unitPrice  Int?
  updateAt   DateTime?

  @@index([orderId])
  @@index([productId])
}

model Price {
  id          String              @id @default(uuid()) @postgresql.Uuid
  price       Float?              @default(0)
  price_type  PricePriceTypeType? @default(retail)
  product     Product[]           @relation("Product_price")
  description String              @default("")
  createdAt   DateTime?           @default(now())
  updateAt    DateTime?           @default(now())
}

model Product {
  id                              String             @id @default(uuid()) @postgresql.Uuid
  status                          String             @default("draft")
  suppilers                       Supplier?          @relation("Product_suppilers", fields: [suppilersId], references: [id])
  suppilersId                     String?            @map("suppilers") @postgresql.Uuid
  stock                           Stock?             @relation("Product_stock", fields: [stockId], references: [id])
  stockId                         String?            @unique @map("stock") @postgresql.Uuid
  tags                            Tag[]              @relation("Product_tags")
  name                            String             @default("")
  price                           Price?             @relation("Product_price", fields: [priceId], references: [id])
  priceId                         String?            @map("price") @postgresql.Uuid
  description                     String             @default("")
  details                         Json               @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  tag                             Tag[]              @relation("Product_tag")
  previewImage                    Image?             @relation("Product_previewImage", fields: [previewImageId], references: [id])
  previewImageId                  String?            @map("previewImage") @postgresql.Uuid
  media                           Json               @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  faqs                            FAQ[]              @relation("Product_faqs")
  averageScore                    Float?             @default(0)
  version                         String             @default("beta")
  ratings                         Rating[]           @relation("Product_ratings")
  publishedAt                     DateTime?
  createdAt                       DateTime?          @default(now())
  updateAt                        DateTime?          @default(now())
  from_CartItem_product           CartItem[]         @relation("CartItem_product")
  from_OrderItem_product          OrderItem[]        @relation("OrderItem_product")
  from_ProductPromotion_productId ProductPromotion[] @relation("ProductPromotion_productId")

  @@index([suppilersId])
  @@index([priceId])
  @@index([previewImageId])
}

model Stock {
  id       String    @id @default(uuid()) @postgresql.Uuid
  product  Product?  @relation("Product_stock")
  type     String    @default("by_stock")
  quantity Int
  updateAt DateTime? @default(now())
}

model ProductPromotion {
  id          String      @id @default(uuid()) @postgresql.Uuid
  productId   Product?    @relation("ProductPromotion_productId", fields: [productIdId], references: [id])
  productIdId String?     @map("productId") @postgresql.Uuid
  promotionId Promotion[] @relation("ProductPromotion_promotionId")
  publishedAt DateTime?
  images      Image[]     @relation("ProductPromotion_images")

  @@index([productIdId])
}

model FAQ {
  id                String    @id @default(uuid()) @postgresql.Uuid
  question          String    @default("")
  answer            Json      @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  from_Product_faqs Product[] @relation("Product_faqs")
}

model Promotion {
  id                                String             @id @default(uuid()) @postgresql.Uuid
  name                              String             @default("")
  discountType                      String?            @default("Percent")
  discountValue                     Int?               @default(0)
  publishedAt                       DateTime?          @default(now())
  from_ProductPromotion_promotionId ProductPromotion[] @relation("ProductPromotion_promotionId")
}

model PointTransaction {
  id         String    @id @default(uuid()) @postgresql.Uuid
  user       User?     @relation("PointTransaction_user", fields: [userId], references: [id])
  userId     String?   @map("user") @postgresql.Uuid
  isFavorite Boolean   @default(false)
  type       String    @default("Earn")
  amount     Int?
  status     String?   @default("requires_payment_method")
  orders     Order[]   @relation("PointTransaction_orders")
  metaData   Json?
  expiredAt  DateTime?
  createdAt  DateTime? @default(now())
  updateAt   DateTime? @default(now())

  @@index([userId])
}

model Image {
  id                           String             @id @default(uuid()) @postgresql.Uuid
  name                         String             @default("")
  altText                      String             @default("")
  src_id                       String?
  src_filesize                 Int?
  src_width                    Int?
  src_height                   Int?
  src_extension                String?
  from_User_avartar            User[]             @relation("User_avartar")
  from_Product_previewImage    Product[]          @relation("Product_previewImage")
  from_ProductPromotion_images ProductPromotion[] @relation("ProductPromotion_images")
}

model Tag {
  id                String    @id @default(uuid()) @postgresql.Uuid
  name              String    @default("")
  posts             Post[]    @relation("Post_tags")
  from_Product_tags Product[] @relation("Product_tags")
  from_Product_tag  Product[] @relation("Product_tag")
}

model Post {
  id       String  @id @default(uuid()) @postgresql.Uuid
  title    String  @default("")
  content  Json    @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  author   User?   @relation("Post_author", fields: [authorId], references: [id])
  authorId String? @map("author") @postgresql.Uuid
  tags     Tag[]   @relation("Post_tags")

  @@index([authorId])
}

enum PricePriceTypeType {
  retail
  wholesale
  base
}
